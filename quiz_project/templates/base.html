{% extends "layout.html" %}

{% block content %}
  <div class="page-header">
    <div>
      <h1>Create a Quiz</h1>
      <p class="text-muted">Paste text, pick options, and generate a structured quiz.</p>
    </div>
  </div>

  {% if error %}
    <div class="alert alert-danger" role="alert">{{ error }}</div>
  {% endif %}

  <form method="post" action="{% url 'home' %}" enctype="multipart/form-data" class="card form-card" id="quiz-form">
    {% csrf_token %}
    <div class="card-body">
      <div class="row g-3">
        <div class="col-12">
          <label class="form-label" for="title">Title (optional)</label>
          <input class="form-control" id="title" name="title" type="text" value="{{ form_values.title }}">
        </div>
        <div class="col-12">
          <label class="form-label" for="text">Source text</label>
          <textarea class="form-control" id="text" name="text" rows="7" placeholder="Paste the content you want to turn into a quiz.">{{ form_values.text }}</textarea>
        </div>
        <div class="col-12">
          <label class="form-label" for="upload">Upload .txt or .md (optional)</label>
          <input class="form-control" id="upload" name="upload" type="file" accept=".txt,.md">
        </div>
        <div class="col-md-4">
          <label class="form-label" for="num_questions">Questions</label>
          <select class="form-select" id="num_questions" name="num_questions">
            <option value="5" {% if form_values.num_questions == "5" %}selected{% endif %}>5</option>
            <option value="10" {% if form_values.num_questions == "10" %}selected{% endif %}>10</option>
            <option value="15" {% if form_values.num_questions == "15" %}selected{% endif %}>15</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label" for="difficulty">Difficulty</label>
          <select class="form-select" id="difficulty" name="difficulty">
            <option value="easy" {% if form_values.difficulty == "easy" %}selected{% endif %}>Easy</option>
            <option value="medium" {% if form_values.difficulty == "medium" %}selected{% endif %}>Medium</option>
            <option value="hard" {% if form_values.difficulty == "hard" %}selected{% endif %}>Hard</option>
          </select>
        </div>
        <div class="col-md-4">
          <label class="form-label" for="language">Output language</label>
          <select class="form-select" id="language" name="language">
            <option value="EN" {% if form_values.language == "EN" %}selected{% endif %}>English</option>
            <option value="ES" {% if form_values.language == "ES" %}selected{% endif %}>Spanish</option>
          </select>
        </div>
      </div>
    </div>
    <div class="card-footer d-flex align-items-center gap-3">
      <button class="btn btn-primary" type="submit" id="generate-btn">
        <span class="spinner-border spinner-border-sm me-2 d-none" id="generate-spinner" aria-hidden="true"></span>
        Generate Quiz
      </button>
      <span class="text-muted small">Saved quizzes appear in History.</span>
    </div>
  </form>

  <script>
    const form = document.getElementById("quiz-form");
    if (form) {
      form.addEventListener("submit", () => {
        const button = document.getElementById("generate-btn");
        const spinner = document.getElementById("generate-spinner");
        if (button && spinner) {
          button.setAttribute("disabled", "disabled");
          spinner.classList.remove("d-none");
        }
      });
    }
  </script>
{% endblock %}
